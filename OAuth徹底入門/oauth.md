# はじめに

OAuthの歴史

この本の目標

* OAuth2.0 は何なのか
* なぜOAuthが機能するのか
* どのようにOAuth2.0を使って地震の問題を解決するのか

を理解する。

# 第1部 はじめの一歩

OAuth2.0の全体像をみていく

## 1. OAuth2.0とは何か？そして、なぜ気にかけるべきなのか？

### 1.1 OAuth2.0とは何か？

OAuthとはシステムを構成しているある要素から別の構成要素にアクセス権をわたすためのもの

OAuthを構成する要素

* リーソス所有者:通常は人
* 保護対象リソース:何らかのWebAPI
* クライアント:保護対象リソースに依って提供されるAPIを利用するソフトウェアすべて

これらの言葉を使って、OAuthの目的を再定義すると、  
**クライアントをリソース所有者の代わりとして保護対象リソースへアクセスさせる**


### 1.2 古き悪しき手法〜クレデンシャルの共有〜

ユーザのパスワードを再提示するような方法
* クライアントに渡したクレデンシャルがばれると。。
  * リソース所有者のあらゆる情報が引き出されうる。(パスワードの使いまわし)
  * ずっと保護対象リソースへのアクセスが許可されてしまう
* リソース所有者からのアクセスなのか、クライアントからなのかがわからない
  * 認可の制御ができない

クライアントに開発者キーみたいななんでもできるクレデンシャルを渡す方法
* クレデンシャルがばれると終わり

クライアントから保護対象リソースへアクセスするのを別パスワードにする
* ユーザビリティが悪い

----
クレデンシャルをクライアントとユーザーのそれぞれの組み合わせごとに別々に発行し、それを保護対象リソースで使えるようにしたい！

### 1.3 アクセス権の委譲

上記を実現するための仕組みがOAuth。
ここで新たに、認可サーバーという登場人物があらわれる

いわゆる認可コードフローだと、クライアントにクレデンシャル(id,passwordとか)が知られずに済む

#### 1.3.1 Basic認証にとって代わるものとパスワード共有に関するアンチパターン

もともと、HTTP経由のAPIがパスワードで保護されるようになったのはどんな経緯か？

#### 1.3.2 権限の委譲　～なぜ重要でどのように行われるのか？～

OAuthはユーザーの権限の一部をクライアントに委譲するよう、クライアントがユーザーにリクエストするための手段を提供している。

#### 1.3.3 ユーザー主導のセキュリティとユーザーの選択

TOFUの原則 ⇒ Trust On First Use
最初に権限に関する決定を下すと、システムはそのあともユーザーの決定を信頼して従うようになる。

3層のリスト
* ホワイトリスト
* グレーリスト
* ブラックリスト

### 1.4 OAuth2.0～良い点と悪い点、そして醜い点～

現時点ではこれ以上のものはない。

### 1.5 OAuth2.0でないものは何か？

**OAuthはHTTPプロトコルを使わずに定義されることはない**
機密情報となるシークレットと情報はネットワーク経由でやり取りされるため、ネットワーク上で機密に扱われるための仕組みの上で動かす必要がある。
 
**OAuthは認証のプロトコルではない** 
OAuthを使って認証を行う仕組みを構築することは可能。

**OAuthでは、あるユーザーから別のユーザーへの権限委譲の中身を定義していない**
OAuthではユーザーからユーザーへの権限委譲を定義していないが、UMAプロトコルではそういったことができるようになっている。

**OAuthは認可プロセスの仕組みを定義していない**
具体的な仕組みは定義していないようだ。

**OAuthはトークンのフォーマットを定義していない**
トークンがJWTであるべき、とかは言っていない。
ただ、トークンの中身がクライアントから見て不明瞭であるべきということを定義している。

**OAuth2.0は暗号に関する方法について定義していない**
どんな暗号化方法を使うかは定義されていない。OAuth1.0の時は決まっていたらしい

**OAuth2.0は単一のプロトコルではない**

### 1.6 まとめ

* OAuthとはトークンの取得方法とそのトークンの使用方法に関することである
* OAuthはシステムをまたいで認可を行えるようにする委譲プロトコルである
* OAuthはパスワード共有のようなアンチパターンを委譲プロトコルに置き換えており、より安全で、かつ、より使いやすいものになっている
* OAuthは自身が扱う問題の範囲を限定し、その問題を適切に解決することに専念しており、そのことが、OAuthをさらに大きなセキュリティの枠組みのなかで役割を果たすための一つの要素となっている

## 2. OAuthダンス~OAuthの構成要素間の相互作用

### 2.1 OAuth2.0プロトコルの概要～トークンの取得と使用～


