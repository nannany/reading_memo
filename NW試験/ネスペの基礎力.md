# 1章 物理層、データリンク層の基礎技術

## 1-1 フレーム構造、パケット構造

### q1 イーサネットのフレーム構造をかけ。

| 宛先MACアドレス | 送信元MACアドレス | タイプ | データ | FCS |
| 6               | 6                 | 2      | 46~1500| 4   |

### q2 イーサネットのフレームサイズはいくつか？

* 64~1518 バイト

### q3 VLANが付加されたら、このフレーム構造はどうなるか？

* 送信元MACアドレスとタイプの間に4バイトのVLAN情報が入る

### q4 HTTPのパケット構造をかけ。

| 送信元IPアドレス | 宛先IPアドレス | プロトロル | その他 | 送信元ポート番号 | 宛先ポート番号 | その他 | データ |
| 4                | 4              | 1          |        | 2                | 2              |        |46~1460 |
| 20                                                      | 20                                         |        |


### q5


### q6 ネットワーク上のパケットを取得するにはどうすればいいか？

* シェアードHUBを入れる。
* ミラーポートを設定する。

### q7 

* あるポートで送受信されているトラフィックを別のポートに出力する機能をミラーリングという。

### q8 

* 自分宛てではないフレームの取得には、プロミスキャスモードにしておく必要がある。

## 1-2 VLAN

### q9 

* VLANによって、ネットワーク構成の変更が容易になる。
* タグVLANうあIEEE802.1Qとして標準化されている。

### q10 タグVLANのフレーム構造をかけ。

| 宛先MACアドレス | 送信元MACアドレス | VLANタグ | タイプ | データ |
| 6               | 6                 | 4        | 2      | 46~1500|

### q11 設定できるVLANの数は最大いくつか。

* 4094 (VLANIDは12ビットで0と4095は使用できないので)

### q12 

* IEEE802.1adはVLANタグ付きのパケットに更にVLANタグをつける感じ。
https://milestone-of-se.nesuke.com/nw-advanced/spb/spbm-summary/

* サービスプロバイダとかで使うために作られた規格っぽい。
https://www.infraexpert.com/study/vlanz17.html

## 1-3 LANケーブルの構造とPoE

### q13 LANケーブル、電話線はなぜともに偶数本の銅線で構成されているのか。

* 電気が流れるためには閉回路である必要があるため。（どうゆうこと？）

### q14 PCとPCをつなぐ場合には、なぜクロスケーブルを使うか？

* https://www.infraexpert.com/study/ethernet3.html
* 最近は自動判別してくれるらしい。

### q15 PoEではどの線を通って電気が流れるか。

* 4578の結線を使うのがTypeB、1236使うのがTypeA

### q16


## 1-4 MACアドレスとARPテーブル

### q17 

* MACアドレスの上位24ビットにはOUI(製造者に固有の値)がある
-------------------------------------------------------------------

# 2章 ネットワーク層、トランスポート層の基礎技術
osi基本参照モデルの3,4層を扱う。

## 2-1 アドレス変換ではNAT、NAPT、CGNの違いから押さえる

NATには送信元IPアドレスを書き換える送信元NATと、宛先IPアドレスを書き換える送信先NATがある。

NATは1対1のアドレス変換を実施するのに対し、NAPTは1対多のアドレス変換を実施する。

### q50 NATテーブルとNAPTテーブルを具体的に書け

NAT 

| 変換前IP          | 変換後IP        |
| 192.168.10.100 | 203.0.10.222 |

NAPT
| 変換前IP         | ポート  | 変換後IP        | ポート |
| 192.168.1.111 | 8080 | 203.1.10.222 | 80  |

## 2-2 IPアドレスは、サブネットの計算を確実に

### q51 IPv4アドレスは何バイトか？
4バイト

### q52 プロトコルの例を3つ

TCP(6)、UDP(17)、ICMP(1)

### q53 プライベートアドレスとして利用できるIPをかけ。

192.168.0.0 ~ 192.168.255.255
172.16.0.0 ~ 172.31.255.255
10.0.0.0 ~ 10.255.255.255

### q54 同じセグメント内に異なるネットワークがあるとどうなるか。例えば、192.168.1.0/24と172.16.1.0/24のネットワークが同一のSWに接続されている場合、通信は正常に行えるか？

ネットワークセグメントが違うもの同士は通信できない。

### q55 25ビット、24ビット、23ビットのサブネットにおいて、利用可能なPCの台数はいくつか？

* 25は125、24は254、23は510

### q56

* スーパーネット化は経路を集約することを意味する

### q57

* ループバックアドレスの範囲は127.0.0.1 ~ 127.255.255.254
* ループバックアドレスを使用するセキュリティ上の利点は、外部からの不正利用があり得ない点にある。

## 2-3 ICMP

### q58 ICMPはTCPかUDPか？

どちらでもない。別のプロトコル

### q59 tracerouteで通信がタイムアウトするのに途中までの経路がわかるのはなぜ？

* TTLが1のパケットを投げて、1つ目のルータまで到達したら破棄されて、time exceededで返ってくる、てのをTTLを1つずつ増やしてやっているから。

## 2-4 IPv6

### q60 0012:0000:0000:0000:ABCD:0000:0000:1200 を圧縮表記せよ

* 12::ABCD:0:0:1200

### q61 IPv4のヘッダの長さは？

* 20バイト

### q62 

* IPv6ヘッダは40バイト
* IPv6のIPアドレスは128ビット
* IPv6には拡張ヘッダがある

### q63 

* `::1`はループバックアドレス
* 200で始まるのはグローバルアドレス
* fd00で始まるのはプライベートアドレス
* fe80::/10 はリンクローカルアドレス

## 2-5 マルチキャスト

### q64 ブロードキャストがある中で、なぜマルチキャストが必要なのか？

* 帯域の節約のため

### q65 ブロードキャストドメインを分割するために必要な装置は何か？

* ルータ、レイヤ3スイッチ

## 2-6 TCP,UDP

### q66 TCPとUDPを使ったプロトコルを3つずつ挙げよ。

* TCP
  * HTTP、FTP、SSH
  * SNMP、DHCP、NTP

### q67 TCPコネクション確立方式である3ウェイハンドシェイクの流れを書け。

* 接続元がSYNコマンドを投げる。それに応じて接続先がSYN+ACKを返す。それに応じて接続元がACKを返す。

### q68 

### q69 確認応答を待たず、データを送信できる仕組みをなんというか？

スライディングウィンドウ。ウィンドウサイズ内であれば、確認応答を待たずにデータを送信できる。

### q70

## 2-7 ルーティングプロトコル

### q71 静的ルーティング、動的ルーティングのメリデメは？

* 静的ルーティング(ex:Static)
  * メリット：設計した人の意図通りの確実な経路選択がされる
  * デメリット：大規模な場合、経路情報が大量になる
* 動的ルーティング(ex:RIP,OSPF,BGP)
  * メリット：自動で最適なルート選択が可能
  * メリット：障害時に自動で経路選択が可能
  * デメリット：ルーティング情報交換用にトラフィックが流れる
  * デメリット：ルータに負荷がかかり、処理が遅くなることがある

### q72

* 静的ルーティングではループを起こしうる。

### q73 RIPのデメリットは？

* 経路変更に時間がかかる。
* ホップ数で経路を判断し、回線速度を考慮しないので、最適な経路を選べない可能性がある。


================

# 3章 アプリケーション層の基礎技術

osi基本参照モデルの5~7層を扱う。

## 3-1
HTTPのCONNECTメソッドは主にプロキシ経由のHTTPS通信をするときに使われる。
CONNECTメソッドでは通信のトンネルをつくる役割をしてくれる。

プロキシ経由のHTTPS通信だと、プロキシはクライアントとサーバの通信を横流しするだけの役割となり、中身を覗くことはできない。
CONNECTでトンネル作って、そのあとにTLSはって、その上にHTTP流す。

## 3-2 DHCP

* DHCPの流れ
1. DHCPクライアントは、DHCPサーバを探すために**DHCP DISCOVER**を**ブロードキャスト**で送信。
1. DHCPサーバは、提供できるIP等の情報をDHCPクライアントに通知するために**DHCP OFFER**を**ユニキャスト**で送信。
1. DHCPクライアントは、DHCPサーバに使用要求を伝えるために**DHCP REQUEST**を**ブロードキャスト**で送信。
  * ネットワーク上に複数のDHCPサーバが存在する可能性があるので、ブロードキャスト送信
1. DHCPサーバは、ネットワーク設定情報の使用要求が認められたことをDHCPクライアントに通知するために**DHCP ACK**を**ユニキャスト**で送信。

### q81 DHCPリレーエージェント機能はどのような時に必要になるか？

DISCOVERとREQUEST はブロードキャストで送信されるので、ルーターを超えることができない。
そのため、同一セグメントにしかDHCPのパケットは送信されない。
なん十個もセグメントがある場合に、各セグメントにDHCPを配置するのは管理の面でも、コストの面でも大変。
DHCPリレーエージェント機能を使用すれば、違うセグメント上にあるDHCPサーバにパケットを中継してくれる。
その結果、1つのDHCPサーバで複数のセグメントのIPアドレスを管理することができるようになる。

### q82 DHCPサーバはどうやって払い出すIPを決めるのか？間違えて違うセグメントのIPを払い出さないのか？

DHCPリレーエージェントで送られるパケットには、DHCPクライアント側のIP情報が入っているので大丈夫。

### q83 複数のDHCPサーバがあるとき、クライアントはどのサーバからアドレスを取得するか？

もっとも早く応答したDHCPサーバ。

### q84 DHCPスヌーピングでは、どのような不正ネットワーク接続を防ごうとしているのか？

不正なDHCPサーバを設置して端末にIPアドレスを払い出すこと、PCに固定でIPアドレスを払い出すこと、の2つ。

スヌーピングの設定しとけば、特定のポート以外からのDHCPパケットは破棄される。


### q86 http://www.seeeko.com/index.html というWebサイトに関して、FQNDとホスト名、ドメイン名、URLを説明せよ。

FQDN: www.seeeko.com
ホスト名: www
ドメイン名: seeeko.com
URL: http://www.seeeko.com/index.html 

### q87 
https://jprs.jp/glossary/index.php?ID=0165

```
example.jp.  3600　IN 　A  192.0.2.101
```

みたいな形でリソースレコードは記述される。

```
${リソースレコードのドメイン名} ${リソースレコードをキャッシュに保持してよい時間} ${リソースレコードのクラス} ${リソースレコードのタイプ} ${リソースレコードのデータ}
```

### q88 ns1.seeeko.com というサーバのIPアドレスを192.168.1.5に指定し、www.seeeko.comというWebサーバのIPアドレスを192.168.1.20に指定する場合、DNSの設定をかけ。

```
ns1  IN A 192.168.1.5
www  IN A 192.168.1.20
```

### q89 

リゾルバ：名前解決処理をしてくれるもの

再帰問い合わせ：クライアントのリゾルバからの依頼に対して、最終的な結果を返すこと
反復問い合わせ：ルートネームサーバから順に問い合わせること

### q90

DNSサーバは、可用性のためにプライマリサーバとセカンダリサーバを用意する。
セカンダリサーバはリフレッシュ間隔でプライマリサーバに対してゾーン転送要求をする。

### q91 DNSキャッシュサーバを導入する利点を述べよ。

DNS問い合わせのWANトラフィックが減る。

### q92 DNSの応答を、DNSキャッシュサーバを経由させる利点を述べよ。

FWの設定が不要である点。
 * キャッシュサーバがどこにある前提で話を進めているのか不明確なので分かりずらい。。。
⇒ 基本キャッシュサーバはFWの内側にある想定
 * 具体的に何が不要になるのか？
 ⇒ おそらく、DNSキャッシュサーバが宛先となっているパケットについてはFWで制限をかけないということだと思う

 ## 3-4 電子メール

* SMTPは認証をしない。
 * 解決策として、POP before SMTP や SMTP AUTH

### q93 POP3の問題点を述べよ。

* 複数のPCから同じメールを読むことができない。
* パスワードが平文で流れる。

### q94 外部メールサーバと内部メールサーバに分ける理由は何か？

* セキュリティのため。

### q95 外部メールサーバと内部メールサーバで動作させるメールサービスをそれぞれ述べよ。

* 外部メールサーバではメール送信サービスを動作させる必要がある。Sendmail,Postfixなど
* 内部メールサーバではメールを外部の中継サーバに送信し、メールの受信も必要となる。よって、送信サービスと受信サービス（devecot）の双方が必要になる

### q96 メールの流れ

* 社内PC⇒社内宛のメール
  * 社内pc⇒内部メールサーバ⇒社内pc
* 社内PC⇒社外宛のメール
  * 社内pc⇒内部メールサーバ⇒外部メールサーバ
* 社外PC⇒社内宛のメール
  * 社外PC⇒外部メールサーバ⇒内部メールサーバ⇒社内PC

### q97 

* ヘッダの見方

### q98 メールのセキュリティ対策

* メール本文の暗号化
  * S/MIME、SMTPS
* SMTP：認証なしでメールが送信される
  * POP before SMTP, SMTP AUTH
* SMTP：送信元の詐称
  * SPF, DKIM
* SMTP：スパムメールの送信
  * OP25B
* POP3：認証パスワードが暗号化されていない
  * APOP, POP3S

### q99

```
権限のない回答:
google.co.jp    text =

        "v=spf1 -all"
```

* この回答から、`google.co.jp`というメールアドレスのドメイン名は一切拒否とわかる。

### q100 SPFはドメインの逆引きとどう違うのか？

* ドメインの逆引きではメールを受信するサーバのIPが得られる。SPFではメールを送信するIPの妥当性を担保できる。

### q101 プロバイダからOP25Bに関する案内が届き、サブミッションポートを使う設定が書いてあったが、まだ変更していない。つまり、送信ポート番号は25のままである。でも、メールの送信ができるのはなぜか？

* 使用しているメールサーバがプロバイダ公認のものであるため。

### q102 25番ポートを禁止しても、代わりに587ポートで通信ができるのであれば、587ポートを使って迷惑メールが送信される。そうであれば、あまり意味がないのでは？

* 587ポートでのメール送信には認証が必要となる。正規の利用者はまだSPAM送信可能であるが、認証しているため足がつく。

### q103 いっそOutBoundだけでなく、すべての25番ポートを禁止したらどうなのか？

* 既存の正規ユーザに設定変更の手間が生じ、利用者に混乱を与えてしまう。

### q104 OP25Bが設定されている状況では、自社でメールサーバを立てる場合に、通常の25番のSMTPでの通信ができないということか？

* その可能性はある。自社でたてたメールサーバから外部のメールサーバに送信したらOP25Bではじかれるかも。ただし、OP25Bはプロバイダ内の固定IPからの通信は規制されないことが多いので、固定IPを取得すれば自由にメールを送れるかも。

## 3-5 FTP

### q105 FTPでは、制御用とデータ転送用に、それぞれ何番ポートを用いているか？

* 制御用に21番ポート、データ転送用に20番ポート

### q106

* 簡易型ファイル転送プロトコルとして、TFTPがある。
* TFTPでは、ユーザ認証はせず、UDPを使用する。

## 3-6 プロキシ

### q107 プロキシサーバ導入の目的はなにか？

* 帯域使用の節約
* セキュリティの強化

### q108 プロキシ設定において、自動設定ファイルを使うメリットは何か？

* 複雑な設定を全社員共有できる点。

### q109 

* TCPのコネクションについて、一般的にはクライアント、プロキシ間とプロキシ、Webサーバ間で張られる

### q110 HTTPSの通信をプロキシサーバはどうやって中継するのか？

* CONNECTメソッドを使って、プロキシに通信を透過するように命じてから暗号化された通信を開始する。
* プロキシは透過するだけの存在になり、本来プロキシで実行されていたセキュリティチェックが行われなくなってしまう。
  * 最近の製品だと、プロキシサーバで通信を複合して、中身を確かめるようなこともしている。

http://nw.seeeko.com/archives/50879231.html

## 3-7 VoIP

* Voice over Internet Protocol
  * 音声をパケット化してIP上で通信する技術
* VoIPのメリット
  * 配線や設備の共通化
  * 通信コストの削減
  * アプリケーション連携
* VoIPのデータは2種
  * 呼制御データ
  * 音声データ


====

# 4章 セキュリティの基礎技術

## 4-1 FW

### q112 ルール一覧にない通信は拒否されるか、許可されるか？

* 基本的には拒否

### q113 ファイアウォールのルールでは、戻りの通信のルールを書く必要があるか？

* ふつうは書かない。動的フィルタリングを行う。

### q114

* UTM(Unified Threat Management)の機能
  * FW
  * VPN
  * 侵入防止
  * バッファオーバーフロー遮断
 
* HA(High Availability)において、StanbyはどうやってActiveの故障を知るのか？
  * StanbyからActiveへのハートビートのロスト
  * Activeの監視しているポートのリンクダウン（物理的にケーブルが外れるとか）
  * デフォルトGWなど特定端末へのpingやTCPのポーリングに失敗した場合（よくわからん。ping,TCP失敗は相手の問題の可能性もあるからStanbyに切り替えてもしょうがないような気がする）

## 4-2 認証LAN

* 認証LANには以下の3方式がある
  * IEEE802.1X認証
  * WEB認証
  * MAC認証
* 最適な方法はIEEE802.1X
  * EAP(Extensible Authentication Protocol)という、認証や暗号鍵配送のフレームワークを使用している

### q115 EAPはどのプロトコルを拡張したのか？

* PPP

### q116 なぜこれまでの認証はPAPやCHAPという簡単な認証でよかったのか？

* PPPは物理的に1対1でつながっており、電話回線やISDN回線では第三者が入り込むことは困難だった。しかし、現在では無線LANが登場し、誰でも自由に参加できるネットワークとなったため。
  * 無線LANは第三者の介入が起こりやすいということ？

### q117 IEEE802.1X認証を実現するのに必要なものは何か。3つ答えよ。

* サプリカント（クライアントソフトにインストールされるソフト）
  * 認証要求をお願いするソフトウェア
* オーセンティケータ（認証Switch、無線AP）
* 認証サーバ

### q118 認証SWから認証サーバへ問い合わせる代表的なプロトコルは何か？

* RADIUS

### q119 認証が成功していない状態で、なぜ認証の接続要求フレームが届くのか？

* 01-80-C2-00-00-03（EAPoLと呼ばれる）は特別な接続要求フレームで、これが来たら特別に通信が許可される

### q120 認証スイッチでIEEE802.01Xによる認証を行う方法がある。しかし、PCをリピータハブ経由でその認証スイッチに接続すると、セキュリティ上の問題が残る。どのような問題があるのか？

* 正規ユーザーが認証に成功すると、認証スイッチの該当ポートがオープンする。よって、そのポートに接続しているハブを経由して接続されているユーザーも接続が許可されてしまう。

## 4-3 IDS/IPS

### q121 なぜ外部からの攻撃をFWで止められないのか？

* FWではHTTP通信等のデータの中身までは確認しない。IDS、IPSはデータの中身まで確認することができる。

## 4-4 IPsec

* IPsecのプロトロルにはESPとAHがある。
* 鍵交換のプロトロルとしては、IKEがある。
* IPsecでの通信間でNATがあると、うまく通信できない可能性がある。その時はNATトラバーサルやVPNパススルーを使う。

### q122 なぜVPNというセキュアなネットワークが必要なのか。個別に暗号化通信をすればよいのではないか？

* 暗号化だけでなく認証、改ざん検知なども含めた総合的なセキュリティを確保できるため
* 利用者の利便性が高いため

### q123 

## 4-5 PKI



-------------------------------------------------------------------------------------

# 5章 ネットワーク関連技術

## 5-1 負荷分散装置

### q133 負荷分散装置を導入することによって得られる利点を2つあげよ。

* 処理能力の向上
* 可用性の向上

### q134 LBでは、通史を振り分け先のサーバに転送するだけか、それとも、送信元IPアドレスを付け替えるか？

* 基本的にはNATによる付替えをする。
  * 付け替えをしないと、送信元ではlb配下のIPからの戻りを受け取ることになり、送信先であるLBとは別のIPから通信を受け取ることになる。これでは受取拒否となるので、付替えは必要。
  * DSRという直接返す方法もある
    * [おすすめされていない模様](https://www.infraexpert.com/study/loadbalancer12.html)

### q135 LBにてソースNATを利用するデメリットはなにか？

* LB配下から見ると、送信元IPアドレスがすべてLBのIPとなる。
  * 対処法として、X-Forwarded-Forヘッダがある。

## 5-2 VRRP
