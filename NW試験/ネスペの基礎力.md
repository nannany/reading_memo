# 2章 ネットワーク層、トランスポート層の基礎技術
osi基本参照モデルの3,4層を扱う。

## 2-1 アドレス変換ではNAT、NAPT、CGNの違いから押さえる

NATには送信元IPアドレスを書き換える送信元NATと、宛先IPアドレスを書き換える送信先NATがある。

NATは1対1のアドレス変換を実施するのに対し、NAPTは1対多のアドレス変換を実施する。

### q50 NATテーブルとNAPTテーブルを具体的に書け

NAT 

| 変換前IP          | 変換後IP        |
| 192.168.10.100 | 203.0.10.222 |

NAPT
| 変換前IP         | ポート  | 変換後IP        | ポート |
| 192.168.1.111 | 8080 | 203.1.10.222 | 80  |

## 2-2 IPアドレスは、サブネットの計算を確実に

### q51 IPv4アドレスは何バイトか？
4バイト

### q52 プロトコルの例を3つ

TCP(6)、UDP(17)、ICMP(1)

### q53 プライベートアドレスとして利用できるIPをかけ。

192.168.0.0 ~ 192.168.255.255
172.16.0.0 ~ 172.31.255.255
10.0.0.0 ~ 10.255.255.255

### q54 同じセグメント内に異なるネットワークがあるとどうなるか。例えば、192.168.1.0/24と172.16.1.0/24のネットワークが同一のSWに接続されている場合、通信は正常に行えるか？

ネットワークセグメントが違うもの同士は通信できない。

================

# 3章 アプリケーション層の基礎技術

osi基本参照モデルの5~7層を扱う。

## 3-1
HTTPのCONNECTメソッドは主にプロキシ経由のHTTPS通信をするときに使われる。
CONNECTメソッドでは通信のトンネルをつくる役割をしてくれる。

プロキシ経由のHTTPS通信だと、プロキシはクライアントとサーバの通信を横流しするだけの役割となり、中身を覗くことはできない。
CONNECTでトンネル作って、そのあとにTLSはって、その上にHTTP流す。

## 3-2 DHCP

* DHCPの流れ
1. DHCPクライアントは、DHCPサーバを探すために**DHCP DISCOVER**を**ブロードキャスト**で送信。
1. DHCPサーバは、提供できるIP等の情報をDHCPクライアントに通知するために**DHCP OFFER**を**ユニキャスト**で送信。
1. DHCPクライアントは、DHCPサーバに使用要求を伝えるために**DHCP REQUEST**を**ブロードキャスト**で送信。
  * ネットワーク上に複数のDHCPサーバが存在する可能性があるので、ブロードキャスト送信
1. DHCPサーバは、ネットワーク設定情報の使用要求が認められたことをDHCPクライアントに通知するために**DHCP ACK**を**ユニキャスト**で送信。

### q81 DHCPリレーエージェント機能はどのような時に必要になるか？

DISCOVERとREQUEST はブロードキャストで送信されるので、ルーターを超えることができない。
そのため、同一セグメントにしかDHCPのパケットは送信されない。
なん十個もセグメントがある場合に、各セグメントにDHCPを配置するのは管理の面でも、コストの面でも大変。
DHCPリレーエージェント機能を使用すれば、違うセグメント上にあるDHCPサーバにパケットを中継してくれる。
その結果、1つのDHCPサーバで複数のセグメントのIPアドレスを管理することができるようになる。

### q82 DHCPサーバはどうやって払い出すIPを決めるのか？間違えて違うセグメントのIPを払い出さないのか？

DHCPリレーエージェントで送られるパケットには、DHCPクライアント側のIP情報が入っているので大丈夫。

### q83 複数のDHCPサーバがあるとき、クライアントはどのサーバからアドレスを取得するか？

もっとも早く応答したDHCPサーバ。

### q84 DHCPスヌーピングでは、どのような不正ネットワーク接続を防ごうとしているのか？

不正なDHCPサーバを設置して端末にIPアドレスを払い出すこと、PCに固定でIPアドレスを払い出すこと、の2つ。

スヌーピングの設定しとけば、特定のポート以外からのDHCPパケットは破棄される。


### q86 http://www.seeeko.com/index.html というWebサイトに関して、FQNDとホスト名、ドメイン名、URLを説明せよ。

FQDN: www.seeeko.com
ホスト名: www
ドメイン名: seeeko.com
URL: http://www.seeeko.com/index.html 

### q87 
https://jprs.jp/glossary/index.php?ID=0165

```
example.jp.  3600　IN 　A  192.0.2.101
```

みたいな形でリソースレコードは記述される。

```
${リソースレコードのドメイン名} ${リソースレコードをキャッシュに保持してよい時間} ${リソースレコードのクラス} ${リソースレコードのタイプ} ${リソースレコードのデータ}
```

### q88 ns1.seeeko.com というサーバのIPアドレスを192.168.1.5に指定し、www.seeeko.comというWebサーバのIPアドレスを192.168.1.20に指定する場合、DNSの設定をかけ。

```
ns1  IN A 192.168.1.5
www  IN A 192.168.1.20
```

### q89 

リゾルバ：名前解決処理をしてくれるもの

再帰問い合わせ：クライアントのリゾルバからの依頼に対して、最終的な結果を返すこと
反復問い合わせ：ルートネームサーバから順に問い合わせること

### q90

DNSサーバは、可用性のためにプライマリサーバとセカンダリサーバを用意する。
セカンダリサーバはリフレッシュ間隔でプライマリサーバに対してゾーン転送要求をする。

### q91 DNSキャッシュサーバを導入する利点を述べよ。

DNS問い合わせのWANトラフィックが減る。

### q92 DNSの応答を、DNSキャッシュサーバを経由させる利点を述べよ。

FWの設定が不要である点。
 * キャッシュサーバがどこにある前提で話を進めているのか不明確なので分かりずらい。。。
⇒ 基本キャッシュサーバはFWの内側にある想定
 * 具体的に何が不要になるのか？
 ⇒ おそらく、DNSキャッシュサーバが宛先となっているパケットについてはFWで制限をかけないということだと思う

 ## 3-4 電子メール

* SMTPは認証をしない。
 * 解決策として、POP before SMTP や SMTP AUTH

### q93 POP3の問題点を述べよ。

* 複数のPCから同じメールを読むことができない。
* パスワードが平文で流れる。

### q94 外部メールサーバと内部メールサーバに分ける理由は何か？

* セキュリティのため。

### q95 外部メールサーバと内部メールサーバで動作させるメールサービスをそれぞれ述べよ。

* 外部メールサーバではメール送信サービスを動作させる必要がある。Sendmail,Postfixなど
* 内部メールサーバではメールを外部の中継サーバに送信し、メールの受信も必要となる。よって、送信サービスと受信サービス（devecot）の双方が必要になる

### q96 メールの流れ

* 社内PC⇒社内宛のメール
  * 社内pc⇒内部メールサーバ⇒社内pc
* 社内PC⇒社外宛のメール
  * 社内pc⇒内部メールサーバ⇒外部メールサーバ
* 社外PC⇒社内宛のメール
  * 社外PC⇒外部メールサーバ⇒内部メールサーバ⇒社内PC

### q97 

* ヘッダの見方

### q98 メールのセキュリティ対策

* メール本文の暗号化
  * S/MIME、SMTPS
* SMTP：認証なしでメールが送信される
  * POP before SMTP, SMTP AUTH
* SMTP：送信元の詐称
  * SPF, DKIM
* SMTP：スパムメールの送信
  * OP25B
* POP3：認証パスワードが暗号化されていない
  * APOP, POP3S

### q99

```
権限のない回答:
google.co.jp    text =

        "v=spf1 -all"
```

* この回答から、`google.co.jp`というメールアドレスのドメイン名は一切拒否とわかる。


### q100 SPFはドメインの逆引きとどう違うのか？

* ドメインの逆引きではメールを受信するサーバのIPが得られる。SPFではメールを送信するIPの妥当性を担保できる。









