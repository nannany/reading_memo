# こわくないソースコードリーディング

* ソースコードリーディングのやり方を知れば怖くない
* ソースコードを読むことのハードルを下げる

## step1:ソースコードを開こう

* コード読むのに何を使う？
  * IDEがおすすめ
* 取得方法
  * mavenでsources.jarをDL
  * git clone
    * README、testも見れる
* なぜソースコードリーディングが難しく感じるのか
  * 知識、論理、読解のスキルが必要
* トレーニングしてく

## step2:ライブラリのコードを読もう

* 読む際に大事なこと
  * 目的、目標を設定する
  * 深く掘り下げすぎない
  * クラスの使い方を把握する
  * 名前に注意する

## step3:構造を読み解こう

* Javalin
* 型を強く意識する
* メモする

# JavaでTracing

## マイクロサービスとは

## Service Meshとは

* サービス間通信のロジックをアプリレイヤーから抜き出し、インフラレイヤへ抽象化する

### Istio

* https://istio.io/
* https://istio.io/docs/ops/architecture/
* Envoy
 * L4L7プロキシ 
* pilot-agent
* pilot-discovery
* mixer
  * テレメトリ？
* Galley
* Citadel
 * 認証

## OpenTracing

* 分散トレーシングの標準化

## OpenCensus

## OpenTelemetry

* OpenCensus と OpenTracingが合体してOpenTelemetry
https://opentelemetry.io/

## なぜ分散トレーシングが重要なのか?

* サービス間のリクエストで問題が発生したらどうする？

* 分散トレーシングではサービス感のリクエストの詳細な状態を記録する
* 複雑なマイクロサービス間の関係をビューとして

## 分散トレーシングの概念

* Trace
  * 分散システム間のリクエストの記録
  * Spanのツリー、DAGで表現される
* Span
* Root Span 
  * Traceの最初のSpan
* Context Propagation
* Tracer Interface

## Spanのフォーマット

## Tracing実装- Zipkin

## Tracing実装- Jaeger

## Jaeger と OpenTelemetryを整理

* 主する領域がそれぞれある

## Propagation Format -b3(Zipkin)

## Quarkus
https://quarkus.io/


# DIコンテナ入門

## DIとは？

* 依存性注入
* 外部から依存しているクラスのインスタンスを注入
* 注入していないコードでは、テストのたびにコード書き換えたりしないといけない
* あるクラスが使用する他のクラスのインスタンスをコンストラクタなどを通じて外部から渡すようなクラス設計 

## コンテナとは？

* 何かの入れ物。何かをコンポーネントとかbeanとか表現する
* DIコンテナの嬉しいところは、「自動でDIをしてインスタンスを構築してくれること」
  * スコープ、AOPの面でも嬉しい
## スコープ
* シングルトン
* プロトタイプ
  * インジェクションされた数だけインスタンスができる
* リクエストスコープ
* セッションスコープ
* なるべくシングルトンを使う
* なるべくプロトタイプは使わない
* HttpServletRequestを使うぐらいならリクエストスコープを使う
* HttpSessionを使うぐらいならセッションスコープを使う

## AOP

* AOPとはコンポーネントのメソッドにコードを変えずに処理を追加できる機能
* AOPを活用している主な例はトランザクション

## DIコンテナの良い使い方

* ルックアップではなく、インジェクションを選ぶ
  * 依存関係がシグニチャに現れる
  * ルックアップは実行されるまで依存関係がチェックされない（そのコンポーネントをDIコンテナに持っているか実行まで分からない）
  * フレームワークに近いレイヤだとルックアップ使う場面もある
* コンストラクタインジェクションを選ぶ
  * 依存コンポーネントをfinalなフィールドにセットできる
  * Javaのクラス設計として違和感がない

# まとめ

* DIとはごく普通のクラス設計の手法
* DIコンテナは依存関係を考慮したインスタンス構築を助けるもの
* ボイラープレートなインスタンス構築コードを省略できる
* ついでにスコープとAOPが付いてきて嬉しい
* コンストラクタインジェクションがオススメ

# ステップアップ
* いくつかのDIコンテナを触ってみて共通する機能、異なる機能を見つけてみる
* DIコンテナを自作してみる（まずはAOPなし、スコープもプロトタイプのみをサポートという仕様がオススメ）
* DIコンテナのソースコードを読むのは結構しんどいけどチャレンジし甲斐はあります
