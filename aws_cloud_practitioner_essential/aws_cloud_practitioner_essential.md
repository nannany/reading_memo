# コースの紹介
 
* AWSクラウドを全体的に理解
* セクション1はAWSクラウドの概念について
* セクション2はAWSのコアサービスについて
* セクション3はセキュリティ
* セクション4はアーキテクチャ設計について
* セクション5は料金とサポートについて

# クラウドの概要

* クラウドぷらくてぃしょなーになることを目的としている。

## クラウドコンピューティングの定義

* 以前は理論上の最大ピークを推測する必要があった。
* 柔軟にITインフラを活用できる。

## アジリティ

* 新しいリソースをすぐ提供できて俊敏性アップ
* 実験を頻繁に実施できる。（コードによるオペレーション）

## AWSインフラについて

* リージョン：世界の物理的な場所
* AZ：

## 伸縮性

* 自分のペースでサービスを利用できる
 
## セキュリティ、コンプライアンス

* 厳しいセキュリティ要件を突破

## 信頼性


## 料金

# 主要なサービス

* カテゴリー、サービスの確認
* コンピューティング：AmazonEC2
* ストレージ：AmazonS3、AmazonEBS
* データベース：
* ネットワーキング：VPC
* 詳細情報を入手する方法

## AWSホスティング

### リージョン

* 二つ以上のアベイラビリティーゾーンをもつ地理的地域

### アベイラビリティーゾーン

* 特定リージョン内のデータセンターの集まり
* 論理的にも物理的にも独立


### エッジロケーション

* AmazonCloudFront
* 客にコンテンツを配信するためのコンテンツ配信ネットワーク

## VPC

### 紹介

* AWSのネットワーキングサービス
* ネットワーク構成を完全にコントロールできる
* ネットにさらすものとVPC内に隔離するものをコントロールできる
* VPC内にEC2とかRDS


### 特徴

* 複数のアベイラビリティーゾーンにまたがる
* サブネットは少数にとどめることを推奨
* サブネットはpublicとprivateがある


### 例

* 最初にリージョンを選択
* VPCを作る
* サブネットA1（public）を作る
* サブネットB1（private）を作る

### まとめ


## セキュリティ

### AWSセキュリティ

* 最重要視している
* 組み込みファイアウォール

### セキュリティグループの作成

* Create Security Group
* インバウンド、アウトバウンドのルール追加

### まとめ

* 仮想ファイアウォールが提供
* http://aws.amazon.comを参照

## コンピューティングサービス

* 需要に合わせてスケールアップ、スケールダウンできる
* AWS Lambdaはコードを実行した時のみ課金される
* AWS ECSはコンテナ管理サービス
* 詳細は https://aws.amazon.com/products/compute

## EC2

### 概要

* ELASTIC COMPUTE CLOUD
* 従量課金
* ハードソフトの幅広い選択肢

### デモ

1. リージョン選択
2. AMIを選択。LINUXとか選ぶ
3. ハードウェアの選択。コア、メモリとか選ぶ
4. インスタンスの設定とかする
5. ストレージの追加。
6. タグを追加。
7. セキュリティグループを追加
8. 確認
9. SSH接続するためにキーペア作成
10. インスタンス作成

## AWS Lambda

### 概要

* 従量課金
* サーバの管理をしなくていい
* Java、Python、node、c#とか使える

### デモ

1. Create Functionページへ
2. Runtimeを設定
3. トリガの設定
。。。

### ユースケース

* キネシスからのストリームを変換してS3に
* ETL
* モバイルバックエンド
* ウェブバックエンド

### まとめ

* AWSサービス間の結合組織


## Elastic Beanstalk

### イントロ

* PaaS
* アプリの迅速なデプロイが可能
* マネージメントの複雑さを減らす？
* いろいろなプラットフォームをサポート
* アプリのアップデートを簡単にできる

### デモ

1. ダッシュボードからElastic Beanstalk選ぶ
2. アプリケーション名記入
3. ウェブサーバ環境を生成。言語選択。コードをアップロード
4. 作成
5. ダッシュボードを確認

## アプリケーションロードバランサー

### イントロ

* リスナー、ターゲット、ターゲットグループ
* プロトコルのサポート強化
* メトリクス強化
* パスベース、ホストベースのルーティング？

### デモ

1. EC2コンソールに入る
2. ロードバランサーをクリック
3. ロードバランサーの名前を付ける
4. ポート決める
5. アベイラビリティーゾーンを決める（2つ以上）
6. セキュリティを設定
7. ルーティングルールを設定
8. ヘルスチェックの設定をする
9. ターゲットを選択
10. 確認、作成
11. 2番目のターゲットグループを作成
12. ルールを編集して送信先を2番目に変更

### まとめ

## Elastic Load Balancing

* クラシックロードバランシングについて説明する

### 概要

* 単一の公開アクセスポイント
* ラウンドロビンか、一番まちが少ないとこに振り分け
* スティッキーセッション
* モニタリング。ヘルスチェック
* パブリックなロードバランサーと内部ロードバランサーがある

### デモ

1. ロードバランサーをクリック
2. Create Load Balancerクリック
3. ロードバランサーの名前をつける
4. リスナーを設定
5. セキュリティグループを割り当てる
6. ヘルスチェックを設定
7. インスタンスを選択してロードバランサーに接続
8. ロードバランサーにタグをつける
9. 確認、生成する

### まとめ

* 起動方法
* ヘルスチェックの設定
* インスタンスの登録


## オートスケーリング

### 概要

* AmazonEC2を適切な数に保つ
* CloudWatchではメトリクス監視はできるが、オートスケールはできない
* スケールアウト：オートスケーリングでインスタンスを追加
* スケールイン：オートスケーリングでインスタンスを終了

###　起動設定

* 定義

### オートスケーリンググループ

* グループの最小値、最大値を設定
* 開始時の数

### オートスケーリングポリシー

* スケジューリング
* スケールアウトのポリシー
* スケールインのポリシー

### CloudWatch Alarm

* アラーム発生の閾値を設定。これがオートスケーリングのトリガーとなる

### デモ

1. オートスケーリンググループをクリック
2. Create Auto スケーリング。。
3. アマゾンAMI選択
4. 起動設定に名前を付ける
5. 作成
。。。。。

### まとめ

* パフォーマンスを維持しながら、コストを最小に抑えられる

## Elastic Block Store（EBS）

### 概要

* ヴォリューム提供
* 複数のサーバ間で自動レプリケーション
* 追加費用なしで暗号化できる
* インスタンス停止なしでキャパ増大できる

### デモ

1. Create Volume
2. Volume Typeを選択。サイズを選択。（gp2がSSD）
3. Create
4. Volumeにアタッチするインスタンスを選択（Attach Volume）
5. sshでEC2に入り込む
6. lsblk コマンドを使用してアタッチされているボリュームを確認
7. mke2fs コマンドでESBボリュームにファイルシステム作成
8. ボリュームをマウント

* State がavailableだとアタッチできる
* ボリュームにタグをつけることができる

## Amazon Simple Storage Service（S3)

* マネージド型ストレージサービス
* 格納オブジェクト数に制限なし
* http、httpsでいつでもどこからでもアクセスできる
* オブジェクトをキーに紐づけてS3に登録
* プロビジョニングの面倒を見る必要がない

### ユースケース

* アプリケーションのデータ保存場所
* HTML、CSS、JSを置く
* データのバックアップ保存先
* ビッグデータのステージング？

### デモ

1. Amazon S3セクション
2. Create bucketでバケット名、リージョン決める。CREATEする
3. AWS CLIを使用して、s3にデータをuploadする。syncで同期させる

## Amazon Relational Database Service（RDS)

* オンプレでRDB使う際の問題点：たくさんの管理タスクあり
* RDSは運用タスクをいろいろやってくれる
* MySQL、SQLServer、Amazon Aurora、ぽすぐれ、MariaDB、Oracleが使える
* フェイルオーバーできる

### ユースケース

* 拡張性、可用性に優れたRDBが必要なウェブアプリ、モバイルアプリ、Eコマースアプリ

### 利点

* ダウンタイムなしでスケールできる
* 信頼性が高い
* パフォーマンスが高い
* セキュリティ
* 運用しやすい

## Amazon DynamoDB

* NoSQLデータストア
* 保存できる項目数に制限はない
* SSDに保存される
* 複合であれ、単一であれ、主キーがいる

### ユースケース

* 構造化データに適す

### デモ

1. Create DynamoDB table
2. テーブル名、主キーを設定

* create itemでデータ追加できる
* キー以外で検索したい場合はScanオペレーション使用する


## Amazon Redshift

* 超並列処理アーキテクチャと列指向ストレージで大規模データに対して、高速なクエリパフォーマンスを発揮


### ユースケース

* 従来のDWHから移行


### デモ

1. Redshiftダッシュボードへ
2. クラスタ名、マスタユーザ、パスワード等設定
3. ネットワーキング設定

## Amazon Aurora

* 高速で可用性に優れる
* SQLクエリを採用
* 従量課金
* マネージド型サービス
* 高可用性
* DBのクラッシュ後の再起動が早い

### マネージドである意味

* オンプレでは管理が大変
* EC2内でのDBはパッチ適用等がまだある

### デモ

1. RDSでAuroraを選択
2. CPU等選択
3. データベース名決める。マスターユーザ、パス決める
4. 配置場所を決める
5. セキュリティグループを決める
6. バックアップ保持期間を決める

### ユースケース

* Expediaのケース
* スケール機能に問題があったが、Auroraに切り替えてうまいこといった

## AWS Trusted Advisor

* 複雑化されるにつれて、最適化されていないリソースがあらわれる。
* コスト、パフォーマンス、セキュリティ、フォールトトレランスの面でどうかアドバイスしてくれる
* CloudWatch Eventsと統合されている

### 実例

* EC2が過剰にプロビジョニングされていたので、設定を最適化
* EBSボリュームのチェックも実施
* 23%のコスト削減

### デモ

1. Trusted Advisor Dashboardへ
2. Service Limits
3. IAMでセキュリティのいろいろ
4. ステータスの要約レポートを受ける設定


# セキュリティ

## AWSのセキュリティの紹介

* 厳しい要件をクリアしている
* 高度なセキュリティサービスを別途受けることもできる
* 組み込みFW、転送時の暗号化、プライベート接続可能、DDOS緩和
* 保管中のデータを暗号化。
* さまざまなログ収集機能、アラート通知機能

## AWSの責任共有モデル

* AWSはグローバルインフラに対して責任を持つ。リージョン、アベイラビリティーゾーン、エッジロケーションが含まれる。
* セキュリティの準拠に関してはサードパーティの監査を受けている
* サービスにおける基本的なセキュリティ設定にはAWSが責任を持つ
* 客が責任を負うのは、リソースへの論理的アクセスコントロール設定、アカウント認証情報の保護
* クラウド上に保存するものは、客が責任を持つ

## AWSのアクセスコントロールとアクセス管理

### IAM

* リソースへのユーザーごとのアクセスを制限できる
* ロールの管理

### デモ

1. IAMコンソールを開く
2. Manage User
3. ユーザーネームいれる。アクセス権選択。パスワード選択
4. グループを作るか、グループをアタッチするか決める。
5. グループを作る
6. ポリシーを選択
7. パスワードポリシーを設定
8. ロールを作成する

* csvでユーザーの情報をエクスポートできる

### ベストプラクティス

* ルートアカウントはすべてにアクセスできるのでアクセスキーを削除する
* MFAを有効にする
* IAMユーザーを作成し、必要な権限のみ付与する
* IAMグループを使用して、権限管理、監査を簡略化する
* IAMパスワードポリシーを利用して強力なPWを作成、また、定期的ローテを強制する
* EC2インスタンスで実行されるアプリにIAMロールを使用する
* 認証情報を共有するのでなく、ロールを使用して委任する
* 認証情報を定期的にローテする
* 不要なユーザー、認証情報を削除する
* ポリシー条件を使用する
* AWSアカウントのアクティビティモニタリングをする

## AWSセキュリティのコンプライアンスプログラム

### AWSのコンプライアンスアプローチ

* サードパーティ認証
* 情報を公開する

### AWSのリスク管理、コンプライアンスプログラム

* リスク管理：内部、外部のリスク評価を受けている
* 定期的にサービスエンドポイントのIPにスキャン

### ホワイトペーパー

* http://aws.amazon.com/complianceで公開

### 客のコンプライアンス

* 確認、設計、特定、検証のアプローチ

## AWSセキュリティリソース

* 詳細は http://AWS.amazon.com/security を参照

### AWS Trusted Advisor

* ベストプラクティスに沿ってリソースを設定できる。

### AWSアカウントチーム

* 客のデプロイと導入を指導。遭遇する可能性のあるセキュリティの問題を案内

### AWSエンタープライズサポート

* 15分以内、24時間対応のコンシェルジュサービス

### AWSプロフェッショナルサービス、AWSパートナーネットワーク

* 客のセキュリティポリシー、セキュリティ手順の構築をサポート

# AWS Architecting Essentials

## 優れた設計のフレームワークの概論

* 5つの観点、セキュリティ、信頼性、パフォーマンス効率、コストの最適化、運用上の優秀性

### セキュリティ

1. IAM。承認、認証されたユーザーのみリソースにアクセスできる
2. 検出制御。ログ取得分析、監査コントロールの統合でセキュリティインシデントを特定
3. インフラの保護。
4. データの保護。
5. インシデント対応

### セキュリティ設計原則

* すべてのレイヤをセキュアに
* トレーサビリティ
* 最小の権限
* 自社システムの保護に重点を置く
* 自動化

### 信頼性

* 障害からの復帰
* 基盤
* 変更管理
* 障害管理

### 信頼性設計原則

* 復旧手順をテスト
* 自動復旧
* 水平スケール
* キャパシティ予測をやめる
* 自動化の変更を管理する

###　パフォーマンス効率の柱

* 選別：最適なソリューション選定が大事
* レビュー：新たな技術の活用につながる
* モニタリング：客に影響がある前に気付ける
* トレードオフ：一貫性等を犠牲にしてパフォーマンスを伸ばす

### パフォーマンス効率設計原則

* 最新のテクノロジーを標準化
* 分単位でのデプロイ
* サーバーレスアーキテクチャ
* 頻繁に実験
* メカニカルシンパシー？

### コスト最適化の柱

* コスト効率の高いリソース
* 需要と供給の一致
* 支出の認識
* 時間の経過


### コスト最適化の設計原則

* 消費モデル：従量課金
* 全体的な効率を評価：システムの生産量とそのコストを評価することが大切
* データセンター運用の支出をなくす：そこはAWSがになう
* 支出を分析し、帰結させる：使用状況、コストを簡単にみれるのでそこからリソース最適化する
* マネージド型サービスを利用して所有コスト削減：そうすることで保守運用費用がなくなる

### 運用上の優秀性

* ビジネス価値を提供するためのシステムの実行とモニタリング
* 継続的にプロセスと手順を改善


## リファレンスアーキテクチャ：耐障害性と高可用性

* ELB、Elastic IP addresses、Route 53、Auto Scaling、CloudWatchについて説明

### 耐障害性ツール

* Amazon Simple Queue Service、Amazon S3、Amazon SimpleDB、Amazon Relational Database Service についての説明

## リファレンスアーキテクチャ：ウェブホスティング

* AWSでは簡単にスケーラブルなウェブホスティングが実現できる
* コスト効率が大事→スケーラブル
* 負荷テストでもトラフィックをシュミレーションできる

### 留意事項

* 物理的ネットワーク機器は不要
* ファイヤウォールはどこでもおける
* 客のホストは一時的かつ動的に存在するもの？

# セクション5：料金設定およびサポートの概要

## 料金の基礎

### 特徴

* 従量課金
* 予約による値引き
* 使用量増加に伴い単価値引き
* AWSの拡大に合わせて支払を値引き（？）

* 固有の要件がある大規模プロジェクト向けのカスタム料金もある

## 料金に関する詳細情報

* 支払いの対象は、コンピューティング、ストレージ、データ転送

### EC2の使用前の検討事項

* サーバーの実働時間。インスタンス作成から終了まで。ElasticIP割り当てから解除まで
* マシン構成。マシンの性能により料金変わってくる
* マシン購入タイプ。前払いだとだいぶ値引きしてくれる
* インスタンス。いっぱいあるとピーク時の負荷を分散して処理できる。作った分料金も上がる
* 負荷分散。ELBの使用も金がかかる
* 詳細モニタリング。基本モニタリングは追加料金なしで利用できるが、詳細は金いる
* Auto Scaling。Cloud Watch に追加料金なしで使える
* Elastic IPアドレス。無料
* OSとソフトウェアパッケージ。OSの料金はインスタンス料金に含まれる。

### S3の使用前の検討事項

* ストレージクラス。どのくらいの可用性を求めるかで金が変わる
* ストレージ。保存されたオブジェクト数、サイズ、ストレージタイプで金が変わる
* リクエスト。リクエストの数とタイプで料金がかわる？
* データ転送。S3リージョンから送信されるデータの量

### EBSの使用前の検討事項

* ボリューム。プロビジョニングした量で料金がきまる
* 1秒当たりの入出力オペレーション回数。
* スナップショット。S3にデータをバックアップできるが、それにも金がかかる
* データ転送。アプリから転送されるデータ量を考慮する

### RDSの使用前の検討事項

* サーバの実働時間。DBインスタンスを作成してから、終了するまで金がかかる
* データベース特性。サイズ、メモリによって料金は変わる
* データベース購入タイプ。前払いで安くなる
* データベースインスタンス数。増やすとピーク時の負荷を処理できる
* プロビジョンドストレージ。データベースストレージの100%を超えるまではバックアップストレージに対する追加料金はかからない
* 追加ストレージ。プロビジョニングされたストレージの料金に加えて、バックアップストレージの料金がかかる
* リクエスト。データベースへの入力リクエストおよび出力リクエストを考慮する
* デプロイタイプ。デプロイするアベイラビリティーゾーンの数によって、ストレージおよび入出力の料金は変わる
* データ転送。着信データ転送は無料で、発信データ転送の料金は階層化される（階層化？）


### CloudFlontの使用前の検討事項

* トラフィックディストリビューション。データ転送、リクエストの料金は地理的リージョンによって異なり、料金はコンテンツが提供されるエッジロケーションに基づく
* リクエスト。実行されるリクエストの数とタイプ、およびリクエストが実行される地理的リージョンを考慮
* データ送信。エッジロケーションから送信されるデータ量


## TCO 計算ツール

* コスト削減のための見積もりに役立つ
* プレゼンで使うレポート出力に役立つ

## AWSサポートプランの概要

* アドバイスをくれる
* テクニカルアカウントマネージャーがアーキテクチャレビューなどしてくれる
* プランとしては、ベーシック、開発者、ビジネス、エンタプライズ向けのサポートプランがある

# ボーナス動画

## セキュリティグループとNACL

* セキュリティグループはステートフル。
* NACL（ネットワークアクセスコントロールリスト）はVPCを超える時に評価される。

## セキュリティグループ

* 個々のインスタンスへのアクセス制限
* VPC内部にあるものはセキュリティグループに属す
* Webサーバから直接DBにアクセスすることは禁止される（適切に階層化してそのような構成にするべき）

## 責任共有モデル

* どこのレイヤで責任を分割するか理解するのが重要
* 物理、ネットワーク、ハイパーバイザはAWSが責任を負う
* OSより上は客が責任を負う

## IAM ユーザー/グループ/ロール

* IAMの文脈でのユーザ、グループ、ロールを見ていく
* ユーザー：永続的な名前を付けられたオペレータ
* グループ：ユーザーの集合
* ロール：権限ではない。認証方法。

* ポリシードキュメント：JSONドキュメント。ホワイトリストで登録。
* 認証と許可の違いを理解するのが重要

## データの暗号化

* 暗号化キー、データキーを作成するエンジンがある。
* オブジェクトごとに暗号化キーがある
* 暗号化キーの管理
* マスターキーの管理もAWSが提供する

## EBS ボリュームの暗号化

* KMSと連携して動作する
* EC2はEBSから受けたオブジェクトをKMSに渡し、複合してもらう

## サブネット、ゲートウェイ、ルート

* 直でネットと通信するのはpublicにする
* 直接インターネットと通信してはならないVPCはprivateにする
* IGW（インターネットゲートウェイ）
* デフォルトルートテーブルが自動的に作成される
* デフォルトルートテーブルはすべてのVPCに適用される
* パブリックルートテーブルは最初デフォルトルートテーブルの内容がコピーされる
* プライベートVPCのパッチあてとかどうするか？→踏み台ホストを設置する
* NATを使ってプライベートVPCからの出口を設定。
* プライベートデータセンターからちょくでプライベートVPCにアクセスするのもあり

# コースのまとめ

* セクション1：クラウドの価値とAWSクラウドを採用する利点
* セクション2：サービス内容と使用する場面
* セクション3：セキュリティ
* セクション4：アーキテクチャ
* セクション5：料金設定
